# Funding Rate Bot ๐

ะัะธะฝััะพะฝะฝัะน Telegram ะฑะพั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ััะฐะฒะพะบ ัะธะฝะฐะฝัะธัะพะฒะฐะฝะธั (funding rates) ะฝะฐ ะบัะธะฟัะพะฒะฐะปััะฝัั ะฑะธัะถะฐั.

## โก ะะพะทะผะพะถะฝะพััะธ

- ๐ **ะัะธะฝััะพะฝะฝะฐั ะฐััะธัะตะบัััะฐ** - ะฑัััััะน ัะฑะพั ะดะฐะฝะฝัั ะพั 9 ะฑะธัะถ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
- ๐พ **ะััะธัะพะฒะฐะฝะธะต ั TTL** - ะทะฐัะธัะฐ ะพั rate limiting (ัะบะพะฝะพะผะธั ะดะพ 80% ะทะฐะฟัะพัะพะฒ)
- ๐ก๏ธ **Thundering Herd Protection** - ะพะดะฝะพะฒัะตะผะตะฝะฝัะต ะทะฐะฟัะพัั ะฝะต ัะพะทะดะฐัั ะฝะฐะณััะทะบั
- ๐ **ะัะฐัะธะฒะพะต ัะพัะผะฐัะธัะพะฒะฐะฝะธะต** - ัะฐะฑะปะธัั, ัะผะพะดะทะธ, ัััะปะบะธ ะฝะฐ ะบะพะฝััะฐะบัั
- โฐ **ะฃะผะฝะฐั ะณััะฟะฟะธัะพะฒะบะฐ** - ะฟะพะบะฐะทัะฒะฐะตั ัะพะบะตะฝั ั ะฑะปะธะถะฐะนัะธะผ funding
- ๐ **ะกะธััะตะผะฐ ะฐะปะตััะพะฒ** - ะฐะฒัะพะผะฐัะธัะตัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั ะพ ะฒััะพะบะธั ััะฐะฒะบะฐั
- ๐ **ะะดะผะธะฝ ะฟะฐะฝะตะปั** - ัะฟัะฐะฒะปะตะฝะธะต ะบััะตะผ ัะพะปัะบะพ ะดะปั ะฐะดะผะธะฝะธัััะฐัะพัะฐ

## ๐ฆ ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะฑะธัะถะธ

- โ Bybit
- โ Binance Futures
- โ MEXC
- โ Gate.io
- โ KuCoin
- โ Bitget
- โ BingX
- โ BitMart
- โ OKX

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Python 3.8+
- Telegram Bot Token
- pip (ะดะปั ัััะฐะฝะพะฒะบะธ ะทะฐะฒะธัะธะผะพััะตะน)

## ๐ ะัััััะน ััะฐัั

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone <repository-url>
cd funding_bot
```

### 2. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
pip install -r requirements.txt
```

### 3. ะะฐัััะพะนะบะฐ .env

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ:

```bash
cp .env.example .env
```

ะะฐะฟะพะปะฝะธัะต ะฟะตัะตะผะตะฝะฝัะต:

```env
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=your_bot_token_here

# Cache Configuration
CACHE_TTL=30  # ะัะตะผั ะถะธะทะฝะธ ะบััะฐ ะฒ ัะตะบัะฝะดะฐั (default: 30)

# Admin Configuration
ADMIN_USER_ID=your_telegram_user_id  # ะขะพะปัะบะพ ััะพั ะฟะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ัะฟัะฐะฒะปััั ะบััะตะผ
```

**ะะฐะบ ัะทะฝะฐัั ัะฒะพะน Telegram User ID:**
- ะะฐะนะดะธัะต ะฑะพัะฐ [@userinfobot](https://t.me/userinfobot)
- ะัะฟัะฐะฒััะต ะตะผั ะปัะฑะพะต ัะพะพะฑัะตะฝะธะต
- ะกะบะพะฟะธััะนัะต ะฒะฐั ID

### 4. ะะฐะฟััะบ ะฑะพัะฐ

```bash
python bot.py
```

ะั ัะฒะธะดะธัะต:
```
INFO - Cache TTL set to: 30 seconds
INFO - Admin user ID set to: 123456789
INFO - Initializing aggregator with cache TTL: 30s
INFO - Bot started
```

## ๐ฑ ะะพะผะฐะฝะดั ะฑะพัะฐ

### ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั

| ะะพะผะฐะฝะดะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| `/start` | ะัะธะฒะตัััะฒะธะต ะธ ัะฟะธัะพะบ ะบะพะผะฐะฝะด |
| `/top` | ะขะพะฟ-5 ัะพะบะตะฝะพะฒ ั ะฑะปะธะถะฐะนัะธะผ funding |
| `/token BTC` | ะะฐะฝะฝัะต ะฟะพ ะบะพะฝะบัะตัะฝะพะผั ัะพะบะตะฝั |
| `/set_threshold 0.5` | ะฃััะฐะฝะพะฒะธัั ะฟะพัะพะณ ะฐะปะตััะฐ (%) |
| `/start_monitoring` | ะะบะปััะธัั ะฐะฒัะพะผะฐัะธัะตัะบะธะต ะฐะปะตััั |
| `/stop_monitoring` | ะัะบะปััะธัั ะฐะปะตััั |
| `/status` | ะะพะบะฐะทะฐัั ัะตะบััะธะต ะฝะฐัััะพะนะบะธ |

### ะะดะผะธะฝัะบะธะต ะบะพะผะฐะฝะดั (ัะพะปัะบะพ ะดะปั ADMIN_USER_ID)

| ะะพะผะฐะฝะดะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| `/cache_stats` | ะกัะฐัะธััะธะบะฐ ะบััะฐ (HIT/MISS, ะฒะพะทัะฐัั ะทะฐะฟะธัะตะน) |
| `/clear_cache` | ะัะธะฝัะดะธัะตะปัะฝะฐั ะพัะธััะบะฐ ะบััะฐ |

## ๐ ะัะธะผะตัั ะฒัะฒะพะดะฐ

### ะะพะผะฐะฝะดะฐ `/top`

```
๐ ะขะะ-5 ะขะะะะะะ
โฐ Bybit funding: 18:00 (25.10, UTC+3)
ะััะณะธะต ะฑะธัะถะธ ะผะพะณัั ะธะผะตัั ะดััะณะพะต ะฒัะตะผั โฌ๏ธ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ด 1. BTC ๐ (โฐ 18:00)
๐ฐ ะฆะตะฝะฐ: $68,234

โโโโโโโโโโโโฌโโโโโโโโโโโโฌโโโโโโโโโ
โะะธัะถะฐ     โ Rate      โ ะัะตะผั  โ
โโโโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโค
โBYBIT     โ +0.5234%  โ 18:00  โ
โBINANCE   โ +0.5120%  โ 18:00  โ
โMEXC      โ +0.4890%  โ 20:00  โ
โโโโโโโโโโโโดโโโโโโโโโโโโดโโโโโโโโโ

๐ ะกััะปะบะธ ะฝะฐ ะบะพะฝััะฐะบัั:
  โข BYBIT: ะัะบัััั โ
  โข BINANCE: ะัะบัััั โ
  โข MEXC: ะัะบัััั โ

๐ก ๐ด ะัะตะฝั ะฒััะพะบะฐั | ๐ ะััะพะบะฐั | ๐ก ะกัะตะดะฝัั | ๐ข ะะธะทะบะฐั
๐ LongโShort | ๐ ShortโLong
โฐ ะัะต ะฒัะตะผะตะฝะฐ ะฒ UTC+3 (ะะกะ). ะะฐะทะฝัะต ะฑะธัะถะธ = ัะฐะทะฝะพะต ะฒัะตะผั funding
```

### ะะพะผะฐะฝะดะฐ `/cache_stats` (ัะพะปัะบะพ ะดะปั ะฐะดะผะธะฝะฐ)

```
๐ ะกัะฐัะธััะธะบะฐ ะบััะฐ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ๏ธ Cache TTL: 30ั
๐ฆ ะัะตะณะพ ะทะฐะฟะธัะตะน: 1
โ ะะฐะปะธะดะฝัั: 1
โ ะััะตะบัะธั: 0

ะะฐะฟะธัะธ ะฒ ะบััะต:
โ grouped_by_token:5
   ะะพะทัะฐัั: 15.3ั / TTL: 30ั
```

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### Cache TTL (ะฒัะตะผั ะถะธะทะฝะธ ะบััะฐ)

ะะตะบะพะผะตะฝะดัะตะผัะต ะทะฝะฐัะตะฝะธั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฝะฐะณััะทะบะธ:

| ะกัะตะฝะฐัะธะน | TTL | ะะฟะธัะฐะฝะธะต |
|----------|-----|----------|
| Dev/Testing | 10-15 ัะตะบ | ะััััะพะต ัะตััะธัะพะฒะฐะฝะธะต |
| ะะฐะปะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน (<10) | 30 ัะตะบ | ะะฐะปะฐะฝั ัะฒะตะถะตััะธ ะธ ะฝะฐะณััะทะบะธ |
| ะกัะตะดะฝะต (10-100) | 30-60 ัะตะบ | ะะฐัะธัะฐ ะพั burst requests |
| ะะฝะพะณะพ (>100) | 60-120 ัะตะบ | ะะธะฝะธะผะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ |
| ะัะตะฝั ะผะฝะพะณะพ (>1000) | 120-300 ัะตะบ | ะะฐะบัะธะผะฐะปัะฝะฐั ะทะฐัะธัะฐ |

**ะะทะผะตะฝะธัั TTL:**
1. ะัะบัะพะนัะต `.env`
2. ะะทะผะตะฝะธัะต `CACHE_TTL=30` ะฝะฐ ะฝัะถะฝะพะต ะทะฝะฐัะตะฝะธะต
3. ะะตัะตะทะฐะฟัััะธัะต ะฑะพัะฐ

### ะะดะผะธะฝะธัััะฐัะพั

ะขะพะปัะบะพ ะฟะพะปัะทะพะฒะฐัะตะปั ั ัะบะฐะทะฐะฝะฝัะผ `ADMIN_USER_ID` ะผะพะถะตั:
- ะัะพัะผะฐััะธะฒะฐัั ััะฐัะธััะธะบั ะบััะฐ (`/cache_stats`)
- ะัะธัะฐัั ะบัั (`/clear_cache`)

**ะะตะทะพะฟะฐัะฝะพััั:**
- โ ะัะต ะฟะพะฟััะบะธ ะดะพัััะฟะฐ ะปะพะณะธัััััั
- โ `.env` ะดะพะปะถะตะฝ ะฑััั ะฒ `.gitignore`
- โ ะะต ะฟัะฑะปะธะบัะนัะต ัะฒะพะน User ID

## ๐๏ธ ะััะธัะตะบัััะฐ

```
funding_bot/
โโโ bot.py                 # ะัะฝะพะฒะฝะพะน ัะฐะนะป ะฑะพัะฐ
โโโ models.py             # ะะพะดะตะปะธ ะดะฐะฝะฝัั (FundingRate, ContractInfo)
โโโ exchanges/            # ะะดะฐะฟัะตัั ะดะปั ะฑะธัะถ
โ   โโโ base.py          # ะะฐะทะพะฒัะน ะบะปะฐัั ExchangeAdapter
โ   โโโ bybit_adapter.py
โ   โโโ binance_adapter.py
โ   โโโ mexc_adapter.py
โ   โโโ gateio_adapter.py
โ   โโโ kucoin_adapter.py
โโโ services/            # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ aggregator.py   # ะะณัะตะณะฐัะธั ะดะฐะฝะฝัั ะพั ะฑะธัะถ
โ   โโโ cache.py        # ะกะธััะตะผะฐ ะบััะธัะพะฒะฐะฝะธั
โ   โโโ formatter.py    # ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ัะพะพะฑัะตะฝะธะน
โโโ docs/               # ะะพะบัะผะตะฝัะฐัะธั
    โโโ CACHE_SYSTEM.md
    โโโ ADMIN_SETUP.md
    โโโ CHANGELOG.md
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะตะท ะบััะฐ
```
10 ะฟะพะปัะทะพะฒะฐัะตะปะตะน ร 5 ะฑะธัะถ = 50 ะทะฐะฟัะพัะพะฒ/ะผะธะฝััั
Risk: โ HIGH (rate limit)
```

### ะก ะบััะตะผ (TTL 30ั)
```
10 ะฟะพะปัะทะพะฒะฐัะตะปะตะน โ ~10 ะทะฐะฟัะพัะพะฒ/ะผะธะฝััั
Risk: โ LOW (80% ัะบะพะฝะพะผะธั)
```

## ๐ Troubleshooting

### ะัะพะฑะปะตะผะฐ: Rate limit ะพั ะฑะธัะถะธ

**ะะตัะตะฝะธะต:**
1. ะฃะฒะตะปะธัััะต `CACHE_TTL` ะฒ `.env`
2. ะัะพะฒะตัััะต `/cache_stats` - ะดะพะปะถะตะฝ ะฑััั ะฒััะพะบะธะน HIT rate
3. ะะตะบะพะผะตะฝะดัะตััั TTL >= 30 ัะตะบัะฝะด

### ะัะพะฑะปะตะผะฐ: "ะฃ ะฒะฐั ะฝะตั ะฟัะฐะฒ ะดะปั ะฒัะฟะพะปะฝะตะฝะธั ััะพะน ะบะพะผะฐะฝะดั"

**ะะตัะตะฝะธะต:**
1. ะฃะทะฝะฐะนัะต ัะฒะพะน User ID ัะตัะตะท @userinfobot
2. ะฃะฑะตะดะธัะตัั ััะพ ะพะฝ ัะพะฒะฟะฐะดะฐะตั ั `ADMIN_USER_ID` ะฒ `.env`
3. ะะตัะตะทะฐะฟัััะธัะต ะฑะพัะฐ

### ะัะพะฑะปะตะผะฐ: ะะฐะฝะฝัะต ะฝะต ะพะฑะฝะพะฒะปััััั

**ะะตัะตะฝะธะต:**
1. ะัะฟะพะปัะทัะนัะต `/clear_cache` (ะตัะปะธ ะฒั ะฐะดะผะธะฝ)
2. ะะปะธ ะฟะพะดะพะถะดะธัะต ะธััะตัะตะฝะธั TTL
3. ะะตัะตะทะฐะฟัััะธัะต ะฑะพัะฐ

## ๐ ะะพะบัะผะตะฝัะฐัะธั

- [CACHE_SYSTEM.md](docs/CACHE_SYSTEM.md) - ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฟะพ ะบััั
- [ADMIN_SETUP.md](docs/ADMIN_SETUP.md) - ะะฐัััะพะนะบะฐ ะฐะดะผะธะฝะธัััะฐัะพัะฐ
- [CHANGELOG.md](docs/CHANGELOG.md) - ะััะพัะธั ะธะทะผะตะฝะตะฝะธะน

## ๐ง ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะฑะฐะฒะธัั ะฝะพะฒัั ะฑะธัะถั

1. ะกะพะทะดะฐะนัะต ัะฐะนะป `exchanges/new_exchange_adapter.py`
2. ะะฐัะปะตะดัะนัะตัั ะพั `ExchangeAdapter`
3. ะะตะฐะปะธะทัะนัะต ะผะตัะพะดั `get_funding_rate()` ะธ `get_all_funding_rates()`
4. ะะพะฑะฐะฒััะต ะฒ `bot.py`:
```python
from exchanges.new_exchange_adapter import NewExchangeAdapter

exchanges = [
    # ...
    NewExchangeAdapter(),
]
```

### ะะฐะฟัััะธัั ัะตััั

```bash
# ะขะตัั ัะพะปัะบะพ MEXC
python test_mexc_only.py

# ะะฑัะธะน async ัะตัั
python test_async.py
```

## ๐ ะะธัะตะฝะทะธั

MIT License

## ๐ค Contributing

Pull requests are welcome!

## ๐ง ะะพะฝัะฐะบัั

ะัะปะธ ั ะฒะฐั ะตััั ะฒะพะฟัะพัั ะธะปะธ ะฟัะตะดะปะพะถะตะฝะธั, ัะพะทะดะฐะนัะต Issue.

---

**โ๏ธ ะะฐะถะฝะพ:** ะญัะพั ะฑะพั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝ ัะพะปัะบะพ ะดะปั ะธะฝัะพัะผะฐัะธะพะฝะฝัั ัะตะปะตะน. ะัะตะณะดะฐ ะฟัะพะฒะตััะนัะต ะดะฐะฝะฝัะต ะฝะฐ ะพัะธัะธะฐะปัะฝัั ัะฐะนัะฐั ะฑะธัะถ ะฟะตัะตะด ะฟัะธะฝััะธะตะผ ัะพัะณะพะฒัั ัะตัะตะฝะธะน.
