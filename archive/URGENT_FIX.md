# üö® –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Conflict Error

## –ü—Ä–æ–±–ª–µ–º–∞
```
telegram.error.Conflict: Conflict: terminated by other getUpdates request; 
make sure that only one bot instance is running
```

## –ü—Ä–∏—á–∏–Ω—ã
1. ‚úÖ –ó–∞–ø—É—â–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞
2. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω webhook (–≤–º–µ—Å—Ç–æ polling)
3. ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ/–∫–æ–º–ø—å—é—Ç–µ—Ä–µ
4. ‚úÖ –ù–µ –æ—á–∏—â–µ–Ω—ã pending updates

## üî• –°–†–û–ß–ù–û–ï –†–ï–®–ï–ù–ò–ï

### –®–∞–≥ 1: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –ø—Ä–æ—Ü–µ—Å—Å—ã

–ù–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ (`/var/www/Just-Funding-Bot/`):

```bash
cd /var/www/Just-Funding-Bot

# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x *.sh

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
./stop_bot.sh

# –£–±–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –í–°–ï Python –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞
pkill -9 -f bot.py
pkill -9 -f "python.*funding"
pkill -9 -f "python3.*funding"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–µ—Ç
ps aux | grep bot.py
pgrep -af bot.py
```

–ï—Å–ª–∏ **–≤—Å–µ –µ—â–µ –≤–∏–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã** - —É–±–µ–π—Ç–µ –∏—Ö –ø–æ PID:
```bash
kill -9 <PID>
```

---

### –®–∞–≥ 2: –£–¥–∞–ª–∏—Ç—å webhook –∏ –æ—á–∏—Å—Ç–∏—Ç—å updates

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ bash —Å–∫—Ä–∏–ø—Ç**
```bash
chmod +x fix_telegram_conflict.sh
./fix_telegram_conflict.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç**
```bash
python3 fix_telegram_conflict.py
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ curl**
```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_BOT_TOKEN –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω –∏–∑ .env
TOKEN="YOUR_BOT_TOKEN"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook
curl "https://api.telegram.org/bot${TOKEN}/getWebhookInfo"

# –£–¥–∞–ª–∏—Ç—å webhook
curl "https://api.telegram.org/bot${TOKEN}/deleteWebhook?drop_pending_updates=true"

# –û—á–∏—Å—Ç–∏—Ç—å updates
curl "https://api.telegram.org/bot${TOKEN}/getUpdates?offset=-1"
```

---

### –®–∞–≥ 3: –ü–æ–¥–æ–∂–¥–∞—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è

```bash
# –í–ê–ñ–ù–û: –ü–æ–¥–æ–∂–¥–∏—Ç–µ –º–∏–Ω–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥!
sleep 30
```

---

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ

```bash
./start_bot_daemon.sh
```

---

## ‚ö†Ô∏è –ï–°–õ–ò –ù–ï –ü–û–ú–û–ì–õ–û

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ù–µ—Ç –ª–∏ –±–æ—Ç–∞ –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ?

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ **–≤—Å–µ** –≤–∞—à–∏ —Å–µ—Ä–≤–µ—Ä—ã, –∫–æ–º–ø—å—é—Ç–µ—Ä—ã, VPS –≥–¥–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –±–æ—Ç:
- –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä (Windows/Mac/Linux)
- –î—Ä—É–≥–æ–π VPS
- Heroku / Railway / –¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç–∏–Ω–≥
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- Screen/tmux —Å–µ—Å—Å–∏—è

**–ù–∞–π—Ç–∏ –≤—Å–µ:**
```bash
# –ù–∞ Linux
ps aux | grep -i funding
ps aux | grep -i bot.py
pgrep -af python

# –£–±–∏—Ç—å –≤—Å–µ
pkill -9 -f bot.py
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Webhook –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ?

–ï—Å–ª–∏ –≤—ã –∫–æ–≥–¥–∞-–ª–∏–±–æ –¥–µ–ø–ª–æ–∏–ª–∏ –±–æ—Ç–∞ –Ω–∞ **Heroku, Railway, Render, Vercel** –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç–∏–Ω–≥ —Å webhook:

```bash
TOKEN="YOUR_BOT_TOKEN"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook
curl "https://api.telegram.org/bot${TOKEN}/getWebhookInfo"

# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://your-app.herokuapp.com/) - —É–¥–∞–ª–∏—Ç–µ:
curl "https://api.telegram.org/bot${TOKEN}/deleteWebhook?drop_pending_updates=true"
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –õ–æ–≥–∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

```bash
# –ù–∞–π—Ç–∏ –í–°–ï Python –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep python

# –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã bot.py
lsof | grep bot.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å systemd —Å–µ—Ä–≤–∏—Å—ã
systemctl list-units | grep -i bot
systemctl list-units | grep -i funding
```

---

## üîß –†–ê–î–ò–ö–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï Python –ø—Ä–æ—Ü–µ—Å—Å—ã (–û–ü–ê–°–ù–û, –µ—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!)
pkill -9 python
pkill -9 python3

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
sudo reboot
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º –Ω–∞ webhook –≤—Ä–µ–º–µ–Ω–Ω–æ

–ò–Ω–æ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏ –æ–±—Ä–∞—Ç–Ω–æ:

```bash
TOKEN="YOUR_BOT_TOKEN"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π webhook (–∑–∞–º–µ–Ω–∏—Ç–µ URL)
curl "https://api.telegram.org/bot${TOKEN}/setWebhook?url=https://example.com/webhook"

# –°—Ä–∞–∑—É —É–¥–∞–ª–∏—Ç—å
curl "https://api.telegram.org/bot${TOKEN}/deleteWebhook?drop_pending_updates=true"

# –ü–æ–¥–æ–∂–¥–∞—Ç—å
sleep 10

# –ó–∞–ø—É—Å—Ç–∏—Ç—å polling
./start_bot_daemon.sh
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ** - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather:

1. –ù–∞–ø–∏—à–∏—Ç–µ @BotFather –≤ Telegram
2. `/newbot`
3. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –∏ username
4. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
5. –ó–∞–º–µ–Ω–∏—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ `.env`
6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `./start_bot_daemon.sh`

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –í–°–ï –ø—Ä–æ—Ü–µ—Å—Å—ã bot.py (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ `ps aux | grep bot.py`)
- [ ] ‚úÖ Webhook —É–¥–∞–ª–µ–Ω (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ getWebhookInfo)
- [ ] ‚úÖ Pending updates –æ—á–∏—â–µ–Ω—ã
- [ ] ‚úÖ –ü—Ä–æ—à–ª–æ –º–∏–Ω–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- [ ] ‚úÖ –ù–µ—Ç –¥—Ä—É–≥–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
- [ ] ‚úÖ –ù–µ—Ç webhook –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ (Heroku –∏ —Ç.–¥.)
- [ ] ‚úÖ –ì–æ—Ç–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ `./start_bot_daemon.sh`

---

## üí° –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –≤ –±—É–¥—É—â–µ–º

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã:**
   ```bash
   ./stop_bot.sh      # –ü–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
   ./start_bot_daemon.sh  # –î–ª—è –∑–∞–ø—É—Å–∫–∞
   ./check_bot.sh     # –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
   ```

2. **–ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –±–æ—Ç–∞ –≤—Ä—É—á–Ω—É—é** —á–µ—Ä–µ–∑ `python bot.py` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd** –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ (—Å–º. SCRIPTS_README.md)

4. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:**
   - Polling –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
   - Webhook –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
   - –ù–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤

---

## üÜò –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ, —Å–æ–±–µ—Ä–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
{
    echo "=== Date ==="
    date
    echo ""
    echo "=== Running processes ==="
    ps aux | grep -i python
    echo ""
    echo "=== Bot processes ==="
    ps aux | grep bot.py
    pgrep -af bot
    echo ""
    echo "=== Webhook info ==="
    curl "https://api.telegram.org/bot$(grep TELEGRAM_BOT_TOKEN .env | cut -d= -f2)/getWebhookInfo"
    echo ""
    echo "=== Recent errors ==="
    tail -50 logs/errors.log
} > diagnostic.txt

cat diagnostic.txt
```

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `diagnostic.txt` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
